
<h1 class="sectionedit1" id="feathers_cookbookdispatching_a_long_press_event_from_a_custom_item_renderer">Feathers Cookbook: Dispatching a long press event from a custom item renderer</h1>
<div class="level1">

<p>
A long press event isn&#039;t built into Starling or Feathers. Starling provides only low-level touch events, and Feathers implements long press only on <a href="/feathers/button" class="wikilink1" title="feathers:button">buttons</a>. Let&#039;s take a look at how to implement long press using low-level touch events to provide the same functionality as a button in an item renderer.
</p>

<p>
First, let&#039;s make sure that we&#039;re only tracking a single touch ID:
</p>
<pre class="code as3"><span class="kw1">protected</span> <span class="kw2">var</span> touchID<span class="sy0">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html"><span class="kw5">int</span></a> = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span></pre>

<p>
There&#039;s no reason to support multi-touch here, so if a touch begins, we&#039;ll ignore new touches and continue to track the original touch until it ends.
</p>

<p>
Next, we want to remember the time when the touch began:
</p>
<pre class="code as3"><span class="kw1">protected</span> <span class="kw2">var</span> touchBeganTime<span class="sy0">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html"><span class="kw5">int</span></a><span class="sy0">;</span></pre>

<p>
We&#039;ll use this value to calculate the duration of the touch, which will determine if we should dispatch the long press event yet.
</p>

<p>
Inside our constructor, or in the component&#039;s <code>initialize()</code> function, we can listen for <code>TouchEvent.TOUCH</code>:
</p>
<pre class="code as3">override <span class="kw1">protected</span> <span class="kw3">function</span> initialize<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addEventListener</span><span class="br0">&#40;</span> TouchEvent<span class="sy0">.</span>TOUCH<span class="sy0">,</span> touchHandler <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="co1">// you may be initializing other things here too</span>
<span class="br0">&#125;</span></pre>

<p>
<p><div class="noteclassic">
For more information about the <code>initialize()</code> function and other parts of the Feathers architecture, see <a href="http://wiki.starling-framework.org/feathers/component-properties-methods" class="urlextern" title="http://wiki.starling-framework.org/feathers/component-properties-methods"  rel="nofollow">Anatomy of a Feathers Component</a>.

</div></p>
</p>

<p>
Now, let&#039;s create our <code>TouchEvent.TOUCH</code> listener. Comments appear inline to explain each step of the process. To see where a touch begins, look at the <code>else</code> block near the bottom.
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw3">function</span> touchHandler<span class="br0">&#40;</span> event<span class="sy0">:</span>TouchEvent <span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="sy0">!</span><span class="kw1">this</span><span class="sy0">.</span>_isEnabled <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="co1">// if we were disabled while tracking touches, clear the touch id.</span>
		<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>touchID <span class="sy0">&gt;</span>= <span class="nu0">0</span> <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="co1">// a touch has begun, so we'll ignore all other touches.</span>
&nbsp;
		<span class="kw2">var</span> touch<span class="sy0">:</span>Touch = event<span class="sy0">.</span>getTouch<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">,</span> <span class="kw1">null</span><span class="sy0">,</span> <span class="kw1">this</span><span class="sy0">.</span>touchID <span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">if</span><span class="br0">&#40;</span> <span class="sy0">!</span>touch <span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
			<span class="co1">// this should not happen.</span>
			<span class="kw1">return</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
&nbsp;
		<span class="kw1">if</span><span class="br0">&#40;</span> touch<span class="sy0">.</span>phase == TouchPhase<span class="sy0">.</span>ENDED <span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
			<span class="co1">// stop checking the duration every frame because the touch ended.</span>
			<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">removeEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">ENTER_FRAME</span><span class="sy0">,</span> enterFrameHandler <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
			<span class="co1">// the touch has ended, so now we can start watching for a new one.</span>
			<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">else</span>
	<span class="br0">&#123;</span>
		<span class="co1">// we aren't tracking another touch, so let's look for a new one.</span>
&nbsp;
		touch = event<span class="sy0">.</span>getTouch<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">,</span> TouchPhase<span class="sy0">.</span>BEGAN <span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">if</span><span class="br0">&#40;</span> <span class="sy0">!</span>touch <span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
			<span class="co1">// we only care about the began phase. ignore all other phases.</span>
			<span class="kw1">return</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
&nbsp;
		<span class="co1">// save the touch ID so that we can track this touch's phases.</span>
		<span class="kw1">this</span><span class="sy0">.</span>touchID = touch<span class="sy0">.</span>id<span class="sy0">;</span>
&nbsp;
		<span class="co1">// save the start time, and we'll use it later</span>
		<span class="kw1">this</span><span class="sy0">.</span>touchBeganTime = <span class="kw7">getTimer</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
		<span class="co1">// we'll check the duration of the touch every frame</span>
		<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">ENTER_FRAME</span><span class="sy0">,</span> enterFrameHandler <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
The structure is a little complicated, but it will ensure that we are only tracking a single touch ID at a time. In multi-touch environments, this is essential.
</p>

<p>
There are two sections that specifically apply to our long press event. In the section for TouchPhase.BEGAN, we call <code>getTimer()</code> to save the time that the touch began. Then, we listen for <code>Event.ENTER_FRAME</code> to track how much time has passed since the touch began. We&#039;ll look at this listener in a moment. In <code>TouchPhase.ENDED</code>, we remove that listener because the touch ends.
</p>

<p>
We need to add one more thing to properly handle touch events before moving on. Let&#039;s add a listener for <code>Event.REMOVED_FROM_STAGE</code> inside the constructor or in the <code>initialize()</code> function:
</p>
<pre class="code as3"><span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">REMOVED_FROM_STAGE</span><span class="sy0">,</span> removedFromStageHandler <span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
The listener will clear the <code>touchID</code> to <code>-1</code> and remove the <code>Event.ENTER_FRAME</code> listener, just we did in <code>TouchPhase.ENDED</code>:
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw3">function</span> removedFromStageHandler<span class="br0">&#40;</span> event<span class="sy0">:</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a> <span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">removeEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">ENTER_FRAME</span><span class="sy0">,</span> longPress_enterFrameHandler <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
This ensures that if a component is removed and reused later, it won&#039;t remember a touch that doesn&#039;t exist anymore.
</p>

<p>
Finally, let&#039;s add the <code>Event.ENTER_FRAME</code> listener to dispatch the long press event:
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw3">function</span> enterFrameHandler<span class="br0">&#40;</span> event<span class="sy0">:</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a> <span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw2">var</span> accumulatedTime<span class="sy0">:</span><a href="http://www.google.com/search?q=number%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:number.html"><span class="kw5">Number</span></a> = <span class="br0">&#40;</span><span class="kw7">getTimer</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">-</span> <span class="kw1">this</span><span class="sy0">.</span>_touchBeginTime<span class="br0">&#41;</span> <span class="sy0">/</span> <span class="nu0">1000</span><span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> accumulatedTime <span class="sy0">&gt;</span>= <span class="nu0">0.5</span> <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">removeEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">ENTER_FRAME</span><span class="sy0">,</span> longPress_enterFrameHandler <span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">this</span><span class="sy0">.</span>dispatchEventWith<span class="br0">&#40;</span> FeathersEventType<span class="sy0">.</span>LONG_PRESS <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
We calculate the duration of the touch in seconds. If it&#039;s greater than half a second, then it&#039;s time to dispatch our event.
</p>

<p>
<p><div class="noteclassic">
You can change the duration to any number of seconds that you prefer. Similar to <code><a href="/feathers/button" class="wikilink1" title="feathers:button">Button</a></code>, you might consider adding a property to your class to make the duration customizable.

</div></p>
</p>

<p>
Be sure to remove the <code>Event.ENTER_FRAME</code> listener. We&#039;ll wait to set <code>touchID</code> to <code>-1</code> when the touch actually ends. Then, dispatch the <code>FeathersEventType.LONG_PRESS</code> constant defined by Feathers.
</p>

</div>
<!-- EDIT1 SECTION "Feathers Cookbook: Dispatching a long press event from a custom item renderer" [1-5139] -->
<h2 class="sectionedit2" id="combined_with_eventtriggered_or_eventchange">Combined with Event.TRIGGERED or Event.CHANGE</h2>
<div class="level2">

<p>
If you plan to combine, <code>FeathersEventType.LONG_PRESS</code> with <code><a href="/feathers/cookbook/item-renderer-triggered-on-tap" class="wikilink1" title="feathers:cookbook:item-renderer-triggered-on-tap">Event.TRIGGERED</a></code> or <code><a href="/feathers/cookbook/item-renderer-select-on-tap" class="wikilink1" title="feathers:cookbook:item-renderer-select-on-tap">Event.CHANGE</a></code>, you will want to add a couple extra things to ensure that the other two events aren&#039;t dispatched after a long press.
</p>

<p>
First, let&#039;s add a member variable to track whether a long press has happened:
</p>
<pre class="code as3"><span class="kw1">protected</span> <span class="kw2">var</span> hasLongPressed<span class="sy0">:</span><a href="http://www.google.com/search?q=boolean%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:boolean.html"><span class="kw5">Boolean</span></a> = <span class="kw1">false</span><span class="sy0">;</span></pre>

<p>
Next, when we add the <code>Event.ENTER_FRAME</code> listener on <code>TouchPhase.BEGAN</code>, we should always reset it to <code>false</code>:
</p>
<pre class="code as3"><span class="co1">// we haven't long pressed yet because the touch just began</span>
<span class="kw1">this</span><span class="sy0">.</span>hasLongPressed = <span class="kw1">false</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// save the start time, and we'll use it later</span>
<span class="kw1">this</span><span class="sy0">.</span>touchBeganTime = <span class="kw7">getTimer</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// we'll check the duration of the touch every frame</span>
<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">ENTER_FRAME</span><span class="sy0">,</span> enterFrameHandler <span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
In the <code>Event.ENTER_FRAME</code> listener, we need to set <code>hasLongPressed</code> to <code>true</code> when we dispatch the event:
</p>
<pre class="code as3"><span class="kw1">if</span><span class="br0">&#40;</span> accumulatedTime <span class="sy0">&gt;</span>= <span class="nu0">0.5</span> <span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span>hasLongPressed = <span class="kw1">true</span><span class="sy0">;</span>
	<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">removeEventListener</span><span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">ENTER_FRAME</span><span class="sy0">,</span> longPress_enterFrameHandler <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">this</span><span class="sy0">.</span>dispatchEventWith<span class="br0">&#40;</span> FeathersEventType<span class="sy0">.</span>LONG_PRESS <span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
Finally, on <code>TouchPhase.ENDED</code>, when we check the bounds before dispatching <code>Event.TRIGGERED</code> or setting <code>isSelected</code>, we should also check if we&#039;ve long pressed:
</p>
<pre class="code as3"><span class="kw1">if</span><span class="br0">&#40;</span> <span class="sy0">!</span><span class="kw1">this</span><span class="sy0">.</span>hasLongPressed <span class="sy0">&amp;&amp;</span> isInBounds <span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <span class="kw1">this</span><span class="sy0">.</span>dispatchEventWith<span class="br0">&#40;</span> <a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span>TRIGGERED <span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">this</span><span class="sy0">.</span>isSelected = <span class="kw1">true</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

</div>
<!-- EDIT2 SECTION "Combined with Event.TRIGGERED or Event.CHANGE" [5140-6700] -->
<h2 class="sectionedit3" id="related_links">Related Links</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="/feathers/item-renderers" class="wikilink1" title="feathers:item-renderers">Introduction to Custom Item Renderers</a></div>
</li>
<li class="level1"><div class="li"> <a href="/feathers/cookbook/item-renderer-select-on-tap" class="wikilink1" title="feathers:cookbook:item-renderer-select-on-tap">Feathers Cookbook: Selecting a custom item renderer on tap or click</a></div>
</li>
<li class="level1"><div class="li"> <a href="/feathers/cookbook/item-renderer-triggered-on-tap" class="wikilink1" title="feathers:cookbook:item-renderer-triggered-on-tap">Feathers Cookbook: Dispatching a triggered event from a custom item renderer</a></div>
</li>
</ul>

<p>
This is a recipe in the <a href="/feathers/cookbook/start" class="wikilink1" title="feathers:cookbook:start">Feathers Cookbook</a>. For more information about Feathers, return to the <a href="/feathers/start" class="wikilink1" title="feathers:start">Feathers Documentation</a>.
</p>

</div>
<!-- EDIT3 SECTION "Related Links" [6701-] -->