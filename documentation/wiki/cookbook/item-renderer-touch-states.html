
<h1 class="sectionedit1" id="feathers_cookbookhandling_touch_states_in_an_item_renderer">Feathers Cookbook: Handling touch states in an item renderer</h1>
<div class="level1">

<p>
You&#039;ve already <a href="/feathers/cookbook/item-renderer-background-skin" class="wikilink1" title="feathers:cookbook:item-renderer-background-skin">added a background skin</a>, but maybe you want to display different background skins depending on if the user is touching your item renderer or not. You might also be interested in displaying different icons or changing the text styles on different touch phases. Let&#039;s listen to <code>TouchEvent.TOUCH</code> and start tracking which touch phase is active. We&#039;ll map the touch phases to states, and then we can choose a background skin (or anything else) based on the current state.
</p>

</div>
<!-- EDIT1 SECTION "Feathers Cookbook: Handling touch states in an item renderer" [1-597] -->
<h2 class="sectionedit2" id="up_and_down_states">Up and Down States</h2>
<div class="level2">

<p>
Let&#039;s start out by tracking whether the user is touching the item renderer or not. If we use terms that you might associate with a button, this will require a default “up” state and a  “down” state for when it is pressed.
</p>

<p>
First, let&#039;s define a <code>currentState</code> property:
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw2">var</span> _currentState = STATE_UP<span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw3">function</span> <span class="kw1">get</span> currentState<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html"><span class="kw5">String</span></a>
<span class="br0">&#123;</span>
	<span class="kw1">return</span> <span class="kw1">this</span><span class="sy0">.</span>_currentState<span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw3">function</span> <span class="kw1">set</span> currentState<span class="br0">&#40;</span> <span class="kw7">value</span><span class="sy0">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html"><span class="kw5">String</span></a> <span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_currentState == <span class="kw7">value</span> <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">this</span><span class="sy0">.</span>_currentState = <span class="kw7">value</span><span class="sy0">;</span>
	<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">invalidate</span><span class="br0">&#40;</span> INVALIDATION_FLAG_STATE <span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
Notice the <code>STATE_UP</code> default value. We&#039;re going to add some constants that represent different states:
</p>
<pre class="code as3"><span class="kw1">public</span> static const STATE_UP<span class="sy0">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html"><span class="kw5">String</span></a> = <span class="st0">&quot;up&quot;</span><span class="sy0">;</span>
<span class="kw1">public</span> static const STATE_DOWN<span class="sy0">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html"><span class="kw5">String</span></a> = <span class="st0">&quot;down&quot;</span><span class="sy0">;</span></pre>

<p>
Later, we&#039;ll set this <code>currentState</code> property in a <code>TouchEvent.TOUCH</code> listener.
</p>

<p>
Next, let&#039;s make sure that we&#039;re only tracking a single touch ID:
</p>
<pre class="code as3"><span class="kw1">protected</span> <span class="kw2">var</span> touchID<span class="sy0">:</span><a href="http://www.google.com/search?q=int%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:int.html"><span class="kw5">int</span></a> = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span></pre>

<p>
There&#039;s no reason to support multi-touch here, so if a touch begins, we&#039;ll ignore new touches and continue to track the original touch until it ends.
</p>

<p>
Inside our constructor, or in the component&#039;s <code>initialize()</code> function, we can listen for <code>TouchEvent.TOUCH</code>:
</p>
<pre class="code as3">override <span class="kw1">protected</span> <span class="kw3">function</span> initialize<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addEventListener</span><span class="br0">&#40;</span>TouchEvent<span class="sy0">.</span>TOUCH<span class="sy0">,</span> touchHandler<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="co1">// you may be initializing other things here too</span>
<span class="br0">&#125;</span></pre>

<p>
<p><div class="noteclassic">
For more information about the <code>initialize()</code> function and other parts of the Feathers architecture, see <a href="http://wiki.starling-framework.org/feathers/component-properties-methods" class="urlextern" title="http://wiki.starling-framework.org/feathers/component-properties-methods"  rel="nofollow">Anatomy of a Feathers Component</a>.

</div></p>
</p>

<p>
Now, let&#039;s create our <code>TouchEvent.TOUCH</code> listener. Comments appear inline to explain each step of the process. To see where a touch begins, look at the <code>else</code> block near the bottom.
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw3">function</span> touchHandler<span class="br0">&#40;</span>event<span class="sy0">:</span>TouchEvent<span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span><span class="sy0">!</span><span class="kw1">this</span><span class="sy0">.</span>_isEnabled<span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="co1">// if we were disabled while tracking touches, clear the touch id.</span>
		<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
&nbsp;
		<span class="co1">// the button should return to the up state, if it is disabled.</span>
		<span class="co1">// you may also use a separate disabled state, if you prefer.</span>
		<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_UP<span class="sy0">;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>touchID <span class="sy0">&gt;</span>= <span class="nu0">0</span> <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="co1">// a touch has begun, so we'll ignore all other touches.</span>
&nbsp;
		<span class="kw2">var</span> touch<span class="sy0">:</span>Touch = event<span class="sy0">.</span>getTouch<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">,</span> <span class="kw1">null</span><span class="sy0">,</span> <span class="kw1">this</span><span class="sy0">.</span>touchID <span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">if</span><span class="br0">&#40;</span> <span class="sy0">!</span>touch <span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
			<span class="co1">// this should not happen.</span>
			<span class="kw1">return</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
&nbsp;
		<span class="kw1">if</span><span class="br0">&#40;</span> touch<span class="sy0">.</span>phase == TouchPhase<span class="sy0">.</span>ENDED <span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
			<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_UP<span class="sy0">;</span>
&nbsp;
			<span class="co1">// the touch has ended, so now we can start watching for a new one.</span>
			<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">else</span>
	<span class="br0">&#123;</span>
		<span class="co1">// we aren't tracking another touch, so let's look for a new one.</span>
&nbsp;
		touch = event<span class="sy0">.</span>getTouch<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">,</span> TouchPhase<span class="sy0">.</span>BEGAN <span class="br0">&#41;</span><span class="sy0">;</span>
		<span class="kw1">if</span><span class="br0">&#40;</span> <span class="sy0">!</span>touch <span class="br0">&#41;</span>
		<span class="br0">&#123;</span>
			<span class="co1">// we only care about the began phase. ignore all other phases.</span>
			<span class="kw1">return</span><span class="sy0">;</span>
		<span class="br0">&#125;</span>
&nbsp;
		<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_DOWN<span class="sy0">;</span>
&nbsp;
		<span class="co1">// save the touch ID so that we can track this touch's phases.</span>
		<span class="kw1">this</span><span class="sy0">.</span>touchID = touch<span class="sy0">.</span>id<span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
It&#039;s a little complicated, but it will ensure that we are only tracking a single touch ID at a time. In multi-touch environments, this is essential.
</p>

<p>
Finally, add a listener for <code>Event.REMOVED_FROM_STAGE</code> inside the constructor or in the <code>initialize()</code> function:
</p>
<pre class="code as3"><span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addEventListener</span><span class="br0">&#40;</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="sy0">.</span><span class="kw8">REMOVED_FROM_STAGE</span><span class="sy0">,</span> removedFromStageHandler<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
The listener will clear the <code>touchID</code> to <code>-1</code> just we did in <code>TouchPhase.ENDED</code>:
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw3">function</span> removedFromStageHandler<span class="br0">&#40;</span>event<span class="sy0">:</span><a href="http://www.google.com/search?q=event%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:event.html"><span class="kw5">Event</span></a><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
This ensures that if a component is reused later, it won&#039;t be trying to track a touch that doesn&#039;t exist anymore.
</p>

</div>
<!-- EDIT2 SECTION "Up and Down States" [598-4309] -->
<h2 class="sectionedit3" id="hover_state">Hover State</h2>
<div class="level2">

<p>
On mobile, Starling doesn&#039;t dispatch touch events for <code>TouchPhase.HOVER</code>. However, on devices with a mouse, you may want to support a separate background skin (or icon or label styles) when the mouse hovers over your item renderer.
</p>

<p>
Let&#039;s start by adding a new state for <code>TouchPhase.HOVER</code>:
</p>
<pre class="code as3"><span class="kw1">public</span> static const STATE_HOVER<span class="sy0">:</span><a href="http://www.google.com/search?q=string%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:string.html"><span class="kw5">String</span></a> = <span class="st0">&quot;hover&quot;</span><span class="sy0">;</span></pre>

<p>
Next, we&#039;ll modify the <code>else</code> block in the <code>TouchEvent.TOUCH</code> listener we created previously:
</p>
<pre class="code as3"><span class="kw1">else</span>
<span class="br0">&#123;</span>
	<span class="co1">// we aren't tracking another touch, so let's look for a new one.</span>
&nbsp;
	touch = event<span class="sy0">.</span>getTouch<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">,</span> TouchPhase<span class="sy0">.</span>BEGAN <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> touch <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_DOWN<span class="sy0">;</span>
&nbsp;
		<span class="co1">// save the touch ID so that we can track this touch's phases.</span>
		<span class="kw1">this</span><span class="sy0">.</span>touchID = touch<span class="sy0">.</span>id<span class="sy0">;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="co1">// this touch didn't begin, so maybe it's a hover.</span>
&nbsp;
	touch = event<span class="sy0">.</span>getTouch<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">,</span> TouchPhase<span class="sy0">.</span>HOVER <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> touch <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_HOVER<span class="sy0">;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="co1">// the only remaining possibility: the hover has ended.</span>
&nbsp;
	<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_UP<span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
Now, if we don&#039;t find a touch for <code>TouchPhase.BEGAN</code>, we also check for <code>TouchPhase.HOVER</code>. This puts us into the hover state. If we check for <code>TouchPhase.BEGAN</code> and <code>TouchPhase.HOVER</code>, and we still don&#039;t find a touch, that means that a hover has ended, and we can return to <code>STATE_UP</code>.
</p>

<p>
That&#039;s not all we need to do, though. When a touch ends, we need to figure out if the mouse is still hovering over our item renderer or if the touch ended outside of the item renderer to decide if we want to change to <code>STATE_UP</code> or <code>STATE_HOVER</code>:
</p>
<pre class="code as3"><span class="kw1">if</span><span class="br0">&#40;</span> touch<span class="sy0">.</span>phase == TouchPhase<span class="sy0">.</span>ENDED <span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	touch<span class="sy0">.</span>getLocation<span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span><span class="kw7">stage</span><span class="sy0">,</span> HELPER_POINT <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw2">var</span> isInBounds<span class="sy0">:</span><a href="http://www.google.com/search?q=boolean%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:boolean.html"><span class="kw5">Boolean</span></a> = <span class="kw1">this</span><span class="sy0">.</span><span class="kw7">contains</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span><span class="kw7">stage</span><span class="sy0">.</span><span class="kw7">hitTest</span><span class="br0">&#40;</span> HELPER_POINT<span class="sy0">,</span> <span class="kw1">true</span> <span class="br0">&#41;</span> <span class="br0">&#41;</span><span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> isInBounds <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_HOVER<span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">else</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span>currentState = STATE_UP<span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="co1">// the touch has ended, so now we can start watching for a new one.</span>
	<span class="kw1">this</span><span class="sy0">.</span>touchID = <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
Notice the <code>isInBounds</code> local variable. What we&#039;re doing there with the call to <code>contains()</code> and <code>hitTest()</code> is ensuring two things: 1) the touch hasn&#039;t moved outside the bounds of the item renderer and 2) nothing else on the display list has moved above the item renderer to block the touch.
</p>

<p>
The second case may be a little confusing, so let&#039;s go into a bit more detail. When Starling handles a touch, it will dispatch <code>TouchEvent.TOUCH</code> to the original target for every single phase of the touch, regardless of whether other objects may be blocking the touch. It&#039;s our responsibility to ensure that a touch is still valid for the original target. We&#039;ll always receive the event for <code>TouchPhase.ENDED</code>, but the call to the <code>hitTest()</code> on the stage may not return the item renderer or any of its children. If that&#039;s the case, then we go back to <code>STATE_UP</code> instead of <code>STATE_HOVER</code>.
</p>

<p>
Also, you may have seen the <code>HELPER_POINT</code> object we passed to <code>getLocation()</code>. We&#039;re going to add a static constant that we can pass into that function so that it doesn&#039;t need to create a new <code>flash.geom.Point</code> for its return value. This will help us avoid some unnecessary garbage collection when we check a touch&#039;s location to help performance a bit:
</p>
<pre class="code as3"><span class="kw1">private</span> static const HELPER_POINT<span class="sy0">:</span><a href="http://www.google.com/search?q=point%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:point.html"><span class="kw5">Point</span></a> = <span class="kw1">new</span> <a href="http://www.google.com/search?q=point%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:point.html"><span class="kw5">Point</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
It&#039;s static to avoid creating a different <code>Point</code> object for every item renderer. We simply need to ensure that multiple item renderers won&#039;t be modifying it at the same time. Since the item renderer isn&#039;t dispatching any events between the call to <code>getLocation()</code> and the call to <code>hitTest()</code>, we know that only one item renderer may be using <code>HELPER_POINT</code> at any given time.
</p>

</div>
<!-- EDIT3 SECTION "Hover State" [4310-8024] -->
<h2 class="sectionedit4" id="selecting_a_background_skin">Selecting a Background Skin</h2>
<div class="level2">

<p>
<a href="/feathers/cookbook/item-renderer-background-skin" class="wikilink1" title="feathers:cookbook:item-renderer-background-skin">Previously</a>, we added a single <code>backgroundSkin</code> property. If we want to show different background skins based on the touch phases, we&#039;ll need to add more properties like <code>backgroundSkin</code> for each touch phase. In the following source code, we&#039;ll assume that a <code>downBackgroundSkin</code> property has been added. We can copy the implementation from <code>backgroundSkin</code> to <code>downBackgroundSkin</code>, but for both properties, we need to make one change. When we add the child, we also set its <code>visible</code> property to <code>false</code>:
</p>
<pre class="code as3"><span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_downBackgroundSkin <span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span>_downBackgroundSkin<span class="sy0">.</span><span class="kw7">visible</span> = <span class="kw1">false</span><span class="sy0">;</span>
	<span class="kw1">this</span><span class="sy0">.</span><span class="kw7">addChildAt</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_downBackgroundSkin<span class="sy0">,</span> <span class="nu0">0</span> <span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
Don&#039;t forget to add that line in the setters for both <code>backgroundSkin</code> and <code>downBackgroundSkin</code> properties. Later, we&#039;ll ensure that the <code>visible</code> property is to <code>true</code> on only the current background skin that is chosen.
</p>

<p>
Now, let&#039;s add the following member variable to our class to hold the currently chosen background skin:
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw2">var</span> _currentBackgroundSkin<span class="sy0">:</span><a href="http://www.google.com/search?q=displayobject%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:displayobject.html"><span class="kw5">DisplayObject</span></a><span class="sy0">;</span></pre>

<p>
We&#039;ll update this value in a new function that we&#039;re also adding to our class:
</p>
<pre class="code as3"><span class="kw1">private</span> <span class="kw3">function</span> updateCurrentBackground<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw2">var</span> newBackground<span class="sy0">:</span><a href="http://www.google.com/search?q=displayobject%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:displayobject.html"><span class="kw5">DisplayObject</span></a> = <span class="kw1">this</span><span class="sy0">.</span>_backgroundSkin<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_currentState == STATE_DOWN <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		newBackground = <span class="kw1">this</span><span class="sy0">.</span>_downBackgroundSkin<span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="co1">// if you have additional states, you can add else ifs here.</span>
&nbsp;
	<span class="co1">// check if the background is different than last time.</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin == newBackground <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">return</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="co1">// if we have an old background, make it invisible again.</span>
		<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="sy0">.</span><span class="kw7">visible</span> = <span class="kw1">false</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
	<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin = newBackground<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="co1">// if we have a new background, make it visible.</span>
		<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="sy0">.</span><span class="kw7">visible</span> = <span class="kw1">true</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
In this simple example code, we&#039;re only checking for <code>STATE_DOWN</code>. We could check for <code>STATE_HOVER</code> by adding an appropriate <code>else if</code> at the end. We could also use a <code>switch</code> statement instead, if preferred. The point here is simply to select the most appropriate background skin for the current state.
</p>

</div>
<!-- EDIT4 SECTION "Selecting a Background Skin" [8025-10303] -->
<h3 class="sectionedit5" id="in_layoutgroup_item_renderers">In LayoutGroup Item Renderers</h3>
<div class="level3">

<p>
If you have a <a href="/feathers/layout-group-item-renderers" class="wikilink1" title="feathers:layout-group-item-renderers">custom item renderer created with LayoutGroup</a>, you can call this function in your <code>preLayout()</code> function:
</p>
<pre class="code as3">override <span class="kw1">protected</span> <span class="kw3">function</span> preLayout<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span>updateCurrentBackground<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	<span class="co1">// you may have other code to place here</span>
<span class="br0">&#125;</span></pre>

<p>
If you are resetting the width and height of the backgroundSkin to <code>0</code> in <code>preLayout()</code>, you should do it for all background skins, since they are still considered by the layout, even if they&#039;re invisible.
</p>

<p>
In the <code>postLayout()</code> function, instead of resizing <code>_backgroundSkin</code>, you should resize <code>_currentBackgroundSkin</code>:
</p>
<pre class="code as3">override <span class="kw1">protected</span> <span class="kw3">function</span> postLayout<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span> <span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin <span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="sy0">.</span><span class="kw7">width</span> = <span class="kw1">this</span><span class="sy0">.</span>actualWidth<span class="sy0">;</span>
		<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="sy0">.</span><span class="kw7">height</span> = <span class="kw1">this</span><span class="sy0">.</span>actualHeight<span class="sy0">;</span>
	<span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

</div>
<!-- EDIT5 SECTION "In LayoutGroup Item Renderers" [10304-11211] -->
<h3 class="sectionedit6" id="in_featherscontrol_item_renderers">In FeathersControl Item Renderers</h3>
<div class="level3">

<p>
If you have a <a href="/feathers/feathers-control-item-renderers" class="wikilink1" title="feathers:feathers-control-item-renderers">custom item renderer created with FeathersControl and IListItemRenderer</a>, you can call this function in your <code>draw()</code> function. First, check for the appropriate flag:
</p>
<pre class="code as3"><span class="kw2">var</span> stateInvalid<span class="sy0">:</span><a href="http://www.google.com/search?q=boolean%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:boolean.html"><span class="kw5">Boolean</span></a> = <span class="kw1">this</span><span class="sy0">.</span>isInvalid<span class="br0">&#40;</span> INVALIDATION_FLAG_STATE <span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw2">var</span> skinInvalid<span class="sy0">:</span><a href="http://www.google.com/search?q=boolean%20inurl:http://livedocs.adobe.com/flex/201/langref/%20inurl:boolean.html"><span class="kw5">Boolean</span></a> = <span class="kw1">this</span><span class="sy0">.</span>isInvalid<span class="br0">&#40;</span> INVALIDATION_FLAG_SKIN <span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Then, call the <code>updateBackgroundSkin()</code> function if either of the flags is set:
</p>
<pre class="code as3"><span class="kw1">if</span><span class="br0">&#40;</span> stateInvalid <span class="sy0">||</span> skinInvalid <span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	<span class="kw1">this</span><span class="sy0">.</span>updateBackgroundSkin<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
You should do this before you call <code>autoSizeIfNeeded()</code> so that the <code>_currentBackgroundSkin</code> can be used for measurement.
</p>

<p>
In <code>layoutChildren()</code>, instead of resizing <code>_backgroundSkin</code>, you should resize <code>_currentBackgroundSkin</code>:
</p>
<pre class="code as3"><span class="kw1">protected</span> <span class="kw3">function</span> layoutChildren<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">:</span><span class="kw1">void</span>
<span class="br0">&#123;</span>
	<span class="kw1">if</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="br0">&#41;</span>
	<span class="br0">&#123;</span>
		<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="sy0">.</span><span class="kw7">width</span> = <span class="kw1">this</span><span class="sy0">.</span>actualWidth<span class="sy0">;</span>
		<span class="kw1">this</span><span class="sy0">.</span>_currentBackgroundSkin<span class="sy0">.</span><span class="kw7">height</span> = <span class="kw1">this</span><span class="sy0">.</span>actualHeight<span class="sy0">;</span>
	<span class="br0">&#125;</span>
&nbsp;
	<span class="co1">// position and resize other children here</span>
<span class="br0">&#125;</span></pre>

<p>
Similarly, if you measure <code>_backgroundSkin</code> in <code>autoSizeIfNeeded()</code>, you should switch to measuring <code>_currentBackgroundSkin</code> instead.
</p>

</div>
<!-- EDIT6 SECTION "In FeathersControl Item Renderers" [11212-12457] -->
<h2 class="sectionedit7" id="related_links">Related Links</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="/feathers/item-renderers" class="wikilink1" title="feathers:item-renderers">Introduction to Custom Item Renderers</a></div>
</li>
</ul>

<p>
This is a recipe in the <a href="/feathers/cookbook/start" class="wikilink1" title="feathers:cookbook:start">Feathers Cookbook</a>. For more information about Feathers, return to the <a href="/feathers/start" class="wikilink1" title="feathers:start">Feathers Documentation</a>.
</p>

</div>
<!-- EDIT7 SECTION "Related Links" [12458-] -->